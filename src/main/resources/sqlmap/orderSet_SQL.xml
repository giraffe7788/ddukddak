<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.dduk.mapper.OrderSetMapper">

	<!-- DB에서 현재 접속한 의사의 오더세트 정보를 가져옴 -->
	<select id="getOrderSetList" resultType="orderSetVO">
		SELECT * FROM ORDER_SET
		WHERE EMP_NO = #{empNo}
	</select>

	<!-- DB에 오더세트를 추가함 -->
	<insert id="createOrderSet" parameterType="orderSetVO">
		<selectKey resultType="String" order="BEFORE" keyProperty="orderSetCd">
			SELECT 'OS' || NVL(TRIM(TO_CHAR(SUBSTR(MAX(ORDER_SET_CD), 3) + 1, '0000')), '0001') AS ORDER_SET_CD FROM ORDER_SET
		</selectKey>
		INSERT INTO ORDER_SET(ORDER_SET_CD, EMP_NO, ORDER_SET_PARCD, ORDER_SET_TYPE, ORDER_SET_NM, ORDER_SET_ORDCD)
		VALUES(#{orderSetCd}, #{empNo}, #{orderSetParcd}, #{orderSetType}, #{orderSetNm}, 
			<!-- 현재 추가한 노드가 오더면 -->
			<if test="orderSetOrdcd != null">
				#{orderSetOrdcd}
			</if>
			<!-- 현재 추가한 노드가 오더가 아니면(카테고리면) -->
            		<if test="orderSetOrdcd == null">
				NULL
			</if>
		)
	</insert>

	<!-- DB에서 오더세트를 삭제함 -->
	<delete id="deleteOrderSet" parameterType="orderSetVO">
		DELETE FROM ORDER_SET
		WHERE ORDER_SET_CD = #{orderSetCd}
	</delete>

	<!-- 오더세트 추가 모달에서 상병 검색을 위한 쿼리 -->
	<select id="getInjuryVOList" resultType="injuryVO">
		SELECT * FROM INJURY
	</select>

	<!-- 오더세트 추가 모달에서 검사 검색을 위한 쿼리 -->
	<select id="getTestVOList" resultType="testVO">
		SELECT * FROM TEST
	</select>

	<!-- 오더세트 추가 모달에서 처방 검색을 위한 쿼리 -->
	<select id="getMedicineVOList" resultType="medicineVO">
		SELECT * FROM MEDICINE
	</select>

	<!-- 오더세트 추가 모달에서 치료 검색을 위한 쿼리 -->
	<select id="getTreatmentVOList" resultType="treatmentVO">
		SELECT * FROM TREATMENT
	</select>

	<!-- 오더세트 추가 모달에서 상병 선택시 해당 상병에 대한 정보를 가져옴 -->
	<select id="getInjuryVODetail" resultType="injuryVO">
		SELECT * FROM INJURY
		WHERE IJ_CD = #{ijCd}
	</select>

	<!-- 오더세트 추가 모달에서 검사 선택시 해당 검사에 대한 정보를 가져옴 -->
	<select id="getTestVODetail" resultType="testVO">
		SELECT * FROM TEST
		WHERE TEST_CD = #{testCd}
	</select>

	<!-- 오더세트 추가 모달에서 처방 선택시 해당 처방에 대한 정보를 가져옴 -->
	<select id="getMedicineVODetail" resultType="medicineVO">
		SELECT * FROM MEDICINE
		WHERE MEDI_CD = #{mediCd}
	</select>

	<!-- 오더세트 추가 모달에서 치료 선택시 해당 치료에 대한 정보를 가져옴 -->
	<select id="getTreatmentVODetail" resultType="treatmentVO">
		SELECT * FROM TREATMENT
		WHERE TM_CD = #{tmCd}
	</select>
	
</mapper>
